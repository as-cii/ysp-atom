// Generated by CoffeeScript 1.12.0
(function() {
  var File, XibToolsHelper, XmlReader;

  File = require('atom').File;

  XmlReader = require('xmlreader');

  module.exports = XibToolsHelper = (function() {
    XibToolsHelper.prototype.propertyLabels = [];

    XibToolsHelper.prototype.classFlie = null;

    XibToolsHelper.prototype.xibFile = null;

    function XibToolsHelper(args) {}

    XibToolsHelper.prototype.openXib = function(filePath) {
      var editor, exec, file, fs, process, self;
      if (filePath == null) {
        editor = atom.workspace.getActivePaneItem();
        file = editor != null ? editor.buffer.file : void 0;
        filePath = file != null ? file.path : void 0;
      }
      process = require('child_process');
      exec = process.exec;
      exec('open "' + filePath + '"');
      fs = new File(filePath, false);
      self = this;
      return fs.onDidChange(function() {
        console.log("文件被修改");
        return fs.read().then(function(xmlString) {
          var xmlreader;
          xmlreader = require('xmlreader');
          return xmlreader.read(xmlString, function(errors, response) {
            if (errors != null) {
              console.log("读取xml错误");
            }
            console.log('RESPONSE', response);
            self.propertyLabels = [];
            self.getPropertyLabelWithView(response.document.objects.view);
            return console.log('SELF.PROPERTYLABELS', self.propertyLabels);
          });
        });
      });
    };

    XibToolsHelper.prototype.newXib = function() {
      var AddDialog, dialog, editor, file, filePath, self;
      AddDialog = require('./add-dialog');
      editor = atom.workspace.getActivePaneItem();
      file = editor != null ? editor.buffer.file : void 0;
      filePath = file != null ? file.path : void 0;
      dialog = new AddDialog(filePath, true);
      self = this;
      dialog.on('file-created', function(event, createdPath) {
        console.log("文件被创建");
        self.openXib(createdPath);
        return false;
      });
      return dialog.attach();
    };

    XibToolsHelper.prototype.getPropertyLabelWithView = function(view) {
      var i, len, ref, subview, subviews;
      if (view.array != null) {
        ref = view.array;
        for (i = 0, len = ref.length; i < len; i++) {
          subview = ref[i];
          this.getPropertyLabelWithView(subview);
        }
        return;
      }
      if ((view.attributes().userLabel != null) && view.attributes().userLabel.startsWith("@")) {
        this.propertyLabels.push(view.attributes().userLabel);
      }
      subviews = view.subviews;
      if (subviews != null) {
        if (subviews.button != null) {
          this.getPropertyLabelWithView(subviews.button);
        }
        if (subviews.label != null) {
          this.getPropertyLabelWithView(subviews.label);
        }
        if (subviews.view != null) {
          return this.getPropertyLabelWithView(subviews.view);
        }
      }
    };

    XibToolsHelper.prototype.saveToJSClass = function() {};

    return XibToolsHelper;

  })();

}).call(this);
